"use strict";(self.webpackChunkproductify=self.webpackChunkproductify||[]).push([[742],{742:(S,h,s)=>{s.r(h),s.d(h,{OrdersComponent:()=>J});var c=s(6814),l=s(6223),f=s(5195),g=s(2296),x=s(617),p=s(4170),v=s(2032),_=s(8525),C=s(6385),y=s(9038),T=s(8645),O=s(9773),t=s(9212),Z=s(1896),u=s(1474);let M=(()=>{class o{constructor(e){this.http=e,this.apiUrl="/api/v1/orders"}placeOrder(e){return this.http.post(this.apiUrl,e)}getOrderById(e){return this.http.get(`${this.apiUrl}/${e}`)}getAllOrders(e=0,n=10){const r=(new u.LE).set("page",e.toString()).set("size",n.toString());return this.http.get(this.apiUrl,{params:r})}getOrdersByUserId(e){return this.http.get(`${this.apiUrl}/user/${e}`)}cancelOrder(e){return this.http.put(`${this.apiUrl}/${e}/cancel`,{})}getOrderItems(e){return this.http.get(`${this.apiUrl}/${e}/items`)}static{this.\u0275fac=function(n){return new(n||o)(t.LFG(u.eN))}}static{this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})(),w=(()=>{class o{constructor(e){this.http=e,this.apiUrl="/api/reviews"}getAll(){return this.http.get(this.apiUrl)}getById(e){return this.http.get(`${this.apiUrl}/${e}`)}create(e){return this.http.post(this.apiUrl,e)}update(e,n){return this.http.put(`${this.apiUrl}/${e}`,n)}delete(e){return this.http.delete(`${this.apiUrl}/${e}`)}getProductReviews(e){return this.http.get(`${this.apiUrl}?productId=${e}`)}createProductReview(e,n){return this.http.post(`/api/products/${e}/reviews`,n)}getProductReviewsPaged(e,n=0,r=10){return this.http.get(`/api/products/${e}/reviews?page=${n}&size=${r}`)}static{this.\u0275fac=function(n){return new(n||o)(t.LFG(u.eN))}}static{this.\u0275prov=t.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}}return o})();var P=s(3680);function A(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"button",13),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return r.searchText="",t.KtG(r.applyFilter())}),t.TgZ(1,"mat-icon"),t._uU(2,"close"),t.qZA()()}}function U(o,d){if(1&o&&(t.TgZ(0,"mat-option",14),t._uU(1),t.qZA()),2&o){const e=d.$implicit;t.Q6J("value",e),t.xp6(1),t.Oqu(e)}}function b(o,d){1&o&&(t.TgZ(0,"div",15),t._uU(1,"Loading orders..."),t.qZA())}function $(o,d){if(1&o&&(t.TgZ(0,"div",16),t._uU(1),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Oqu(e.error)}}function F(o,d){1&o&&(t.TgZ(0,"div",20),t._uU(1,"No orders found."),t.qZA())}function I(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"div",32),t._UZ(1,"img",33),t.TgZ(2,"div",34)(3,"div",35),t._uU(4),t.qZA(),t._UZ(5,"div",36),t.TgZ(6,"div",37),t._uU(7),t.qZA(),t.TgZ(8,"div",38)(9,"button",39),t.NdJ("click",function(){const i=t.CHM(e).$implicit,a=t.oxw(3);return t.KtG(a.buyAgain(i))}),t._uU(10,"Buy Again"),t.qZA(),t.TgZ(11,"button",40),t.NdJ("click",function(){const i=t.CHM(e).$implicit,a=t.oxw().$implicit,m=t.oxw(2);return t.KtG(m.writeReview(a,i))}),t._uU(12,"Write Review"),t.qZA()()()()}if(2&o){const e=d.$implicit;t.xp6(1),t.s9C("alt",e.productName),t.Q6J("src",e.image||"assets/placeholder.png",t.LSH),t.xp6(3),t.Oqu(e.productName),t.xp6(3),t.AsE("Qty: ",e.quantity," \u2022 Price: \u20b9",e.price.toFixed(2),"")}}function N(o,d){if(1&o){const e=t.EpF();t.TgZ(0,"mat-card",21)(1,"div",22)(2,"div",23)(3,"div")(4,"strong"),t._uU(5,"Order ID:"),t.qZA(),t._uU(6),t.qZA(),t.TgZ(7,"div")(8,"strong"),t._uU(9,"Placed:"),t.qZA(),t._uU(10),t.ALo(11,"date"),t.qZA(),t.TgZ(12,"div")(13,"strong"),t._uU(14,"Shipped To:"),t.qZA(),t._uU(15),t.qZA()(),t.TgZ(16,"div",24)(17,"div",25),t._uU(18),t.qZA(),t.TgZ(19,"div",26),t._uU(20),t.qZA(),t.TgZ(21,"div",27)(22,"button",28),t.NdJ("click",function(){const i=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.viewOrderDetails(i))}),t._uU(23,"View Order Details"),t.qZA(),t.TgZ(24,"button",29),t.NdJ("click",function(){const i=t.CHM(e).$implicit,a=t.oxw(2);return t.KtG(a.downloadInvoice(i))}),t._uU(25,"Download Invoice"),t.qZA()()()(),t._UZ(26,"mat-divider"),t.TgZ(27,"div",30),t.YNc(28,I,13,5,"div",31),t.qZA()()}if(2&o){const e=d.$implicit;t.xp6(6),t.hij(" ",e.id,""),t.xp6(4),t.hij(" ",t.xi3(11,7,e.placedAt,"mediumDate"),""),t.xp6(5),t.hij(" ",e.shippedTo,""),t.xp6(3),t.hij("Total: \u20b9",e.total.toFixed(2),""),t.xp6(1),t.Q6J("ngClass",e.status.toLowerCase()),t.xp6(1),t.Oqu(e.status),t.xp6(8),t.Q6J("ngForOf",e.items)}}function L(o,d){if(1&o&&(t.TgZ(0,"div",17),t.YNc(1,F,2,0,"div",18)(2,N,29,10,"mat-card",19),t.qZA()),2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",0===e.filteredOrders.length),t.xp6(1),t.Q6J("ngForOf",e.filteredOrders)}}let J=(()=>{class o{constructor(e,n,r){this.router=e,this.orderService=n,this.reviewService=r,this.orders=[],this.filteredOrders=[],this.years=[],this.selectedYear="",this.searchText="",this.isLoading=!1,this.error=null,this.destroy$=new T.x}ngOnInit(){this.loadOrders()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}loadOrders(){this.isLoading=!0,this.error=null,this.orderService.getAllOrders(0,100).pipe((0,O.R)(this.destroy$)).subscribe({next:e=>{this.orders=e.data.map(r=>({id:r.id,placedAt:r.createdAt,shippedTo:r.shippingAddress?.city||"Delivery Address",total:r.totalAmount,status:r.status,items:r.items||[]}));const n=new Set;this.orders.forEach(r=>n.add(new Date(r.placedAt).getFullYear())),this.years=Array.from(n).sort((r,i)=>i-r),this.applyFilter(),this.isLoading=!1},error:e=>{this.error="Failed to load orders. Please try again.",this.isLoading=!1,console.error("Error loading orders:",e)}})}applyFilter(){const e=this.searchText.trim().toLowerCase();this.filteredOrders=this.orders.filter(n=>(!this.selectedYear||String(new Date(n.placedAt).getFullYear())===String(this.selectedYear))&&(!(e&&!String(n.id).toLowerCase().includes(e)&&!n.shippedTo.toLowerCase().includes(e)&&!String(n.total).includes(e))||n.items.some(r=>(r.productName||"").toLowerCase().includes(e))))}downloadInvoice(e){const n=this.generateInvoiceText(e),r=new Blob([n],{type:"text/plain"}),i=window.URL.createObjectURL(r),a=document.createElement("a");a.href=i,a.download=`${e.id}-invoice.txt`,a.click(),window.URL.revokeObjectURL(i)}generateInvoiceText(e){let n=`Invoice for ${e.id}\nPlaced: ${new Date(e.placedAt).toLocaleString()}\nShipped To: ${e.shippedTo}\n\nItems:\n`;return e.items.forEach(r=>{n+=` - ${r.productName||"Product"} x${r.quantity} @ \u20b9${r.price.toFixed(2)}\n`}),n+=`\nTotal: \u20b9${e.total.toFixed(2)}\n\nThank you for your purchase.`,n}buyAgain(e){alert(`${e.productName} added to cart.`)}writeReview(e,n){const r=prompt("Enter rating 1-5","5");if(null===r)return;const i=Number(r);if(isNaN(i)||i<1||i>5)return void alert("Invalid rating");const a=prompt("Write your review","");null!==a&&this.reviewService.createProductReview(n.productId,{productId:n.productId,rating:i,comment:a,title:`Review for ${n.productName}`}).pipe((0,O.R)(this.destroy$)).subscribe({next:()=>alert("Thanks for your review!"),error:m=>{console.error("Error submitting review:",m),alert("Failed to submit review. Please try again.")}})}viewOrderDetails(e){this.router.navigate([`/order-detail/${e.id}`])}static{this.\u0275fac=function(n){return new(n||o)(t.Y36(Z.F0),t.Y36(M),t.Y36(w))}}static{this.\u0275cmp=t.Xpm({type:o,selectors:[["app-orders"]],standalone:!0,features:[t.jDz],decls:20,vars:7,consts:[[1,"orders-root"],[1,"orders-header"],[1,"controls"],["appearance","outline",1,"search"],["matInput","","placeholder","Search orders",3,"ngModel","ngModelChange"],["mat-icon-button","","matSuffix","",3,"click",4,"ngIf"],["appearance","outline",1,"year"],[3,"ngModel","ngModelChange","selectionChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","orders-list",4,"ngIf"],["mat-icon-button","","matSuffix","",3,"click"],[3,"value"],[1,"loading"],[1,"error"],[1,"orders-list"],["class","empty",4,"ngIf"],["class","order-card",4,"ngFor","ngForOf"],[1,"empty"],[1,"order-card"],[1,"order-top"],[1,"order-meta"],[1,"order-summary"],[1,"total"],[1,"status",3,"ngClass"],[1,"actions"],["mat-raised-button","","color","primary",3,"click"],["mat-stroked-button","",3,"click"],[1,"order-items"],["class","order-item",4,"ngFor","ngForOf"],[1,"order-item"],[3,"src","alt"],[1,"item-body"],[1,"item-title"],[1,"item-desc"],[1,"item-meta"],[1,"item-actions"],["mat-button","","color","primary",3,"click"],["mat-button","",3,"click"]],template:function(n,r){1&n&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h2"),t._uU(3,"My Orders"),t.qZA(),t.TgZ(4,"div",2)(5,"mat-form-field",3)(6,"mat-label"),t._uU(7,"Search orders / products / order id"),t.qZA(),t.TgZ(8,"input",4),t.NdJ("ngModelChange",function(a){return r.searchText=a})("ngModelChange",function(){return r.applyFilter()}),t.qZA(),t.YNc(9,A,3,0,"button",5),t.qZA(),t.TgZ(10,"mat-form-field",6)(11,"mat-label"),t._uU(12,"Year"),t.qZA(),t.TgZ(13,"mat-select",7),t.NdJ("ngModelChange",function(a){return r.selectedYear=a})("selectionChange",function(){return r.applyFilter()}),t.TgZ(14,"mat-option",8),t._uU(15,"All"),t.qZA(),t.YNc(16,U,2,2,"mat-option",9),t.qZA()()()(),t.YNc(17,b,2,0,"div",10)(18,$,2,1,"div",11)(19,L,3,2,"div",12),t.qZA()),2&n&&(t.xp6(8),t.Q6J("ngModel",r.searchText),t.xp6(1),t.Q6J("ngIf",r.searchText),t.xp6(4),t.Q6J("ngModel",r.selectedYear),t.xp6(3),t.Q6J("ngForOf",r.years),t.xp6(1),t.Q6J("ngIf",r.isLoading),t.xp6(1),t.Q6J("ngIf",r.error),t.xp6(1),t.Q6J("ngIf",!r.isLoading))},dependencies:[c.ez,c.mk,c.sg,c.O5,c.uU,l.u5,l.Fj,l.JJ,l.On,f.QW,f.a8,g.ot,g.lW,g.RK,x.Ps,x.Hw,p.lN,p.KE,p.hX,p.R9,v.c,v.Nt,_.LD,_.gD,P.ey,C.t,C.d,y.ie],styles:[".orders-root[_ngcontent-%COMP%]{padding:20px;max-width:1200px;margin:0 auto}.orders-header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:16px}.orders-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0}.controls[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center}.controls[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:380px}.controls[_ngcontent-%COMP%]   .year[_ngcontent-%COMP%]{width:140px}.loading[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#666}.error[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#d32f2f;background:#ffebee;border-radius:4px;margin-bottom:16px}.orders-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.empty[_ngcontent-%COMP%]{padding:24px;text-align:center;color:#666}.order-card[_ngcontent-%COMP%]{padding:0}.order-top[_ngcontent-%COMP%]{display:flex;justify-content:space-between;padding:12px 16px}.order-meta[_ngcontent-%COMP%]{display:flex;gap:16px;color:#444;align-items:center}.order-summary[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:center;flex-wrap:wrap}.total[_ngcontent-%COMP%]{font-weight:600}.status[_ngcontent-%COMP%]{padding:6px 10px;border-radius:16px;font-size:13px;color:#fff}.status.pending[_ngcontent-%COMP%]{background:#ff9800}.status.shipped[_ngcontent-%COMP%]{background:#3f51b5}.status.delivered[_ngcontent-%COMP%]{background:#4caf50}.status.cancelled[_ngcontent-%COMP%]{background:#9e9e9e}.actions[_ngcontent-%COMP%]{display:flex;gap:8px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{font-size:12px}.order-items[_ngcontent-%COMP%]{padding:12px 16px;display:flex;flex-direction:column;gap:12px}.order-item[_ngcontent-%COMP%]{display:flex;gap:12px;align-items:flex-start}.order-item[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:96px;height:96px;object-fit:cover;border-radius:6px;border:1px solid #eee}.item-body[_ngcontent-%COMP%]{flex:1}.item-title[_ngcontent-%COMP%]{font-weight:600;margin-bottom:6px}.item-desc[_ngcontent-%COMP%]{color:#666;font-size:13px;margin-bottom:6px}.item-meta[_ngcontent-%COMP%]{color:#777;font-size:13px;margin-bottom:8px}.item-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}@media (max-width:900px){.controls[_ngcontent-%COMP%]   .search[_ngcontent-%COMP%]{width:220px}}"]})}}return o})()}}]);